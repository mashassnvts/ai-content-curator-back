# Инструкция по деплою на Railway

## Что будет работать после деплоя

После деплоя всего бэкенда на Railway будут работать:
- ✅ **API сервер** - веб-приложение сможет обращаться к API
- ✅ **Telegram бот** - бот будет работать и отвечать на сообщения
- ✅ **База данных** - все данные будут сохраняться в PostgreSQL на Railway

## Переменные окружения для Railway

Убедитесь, что установлены следующие переменные окружения в Railway:

### Обязательные переменные:
- `DATABASE_URL` - URL подключения к PostgreSQL (Railway автоматически создает)
- `TELEGRAM_BOT_TOKEN` - токен Telegram бота
- `GEMINI_API_KEY` - ключ API для Gemini
- `JWT_SECRET` - секретный ключ для JWT токенов
- `PORT` - порт (Railway устанавливает автоматически, обычно 10000)

### Опциональные переменные:
- `API_URL` - URL API сервера (если бот и сервер на разных инстансах)
- `CORS_ORIGIN` - разрешенные origins для CORS (через запятую)
- `SCRAPINGBEE_API_KEY` - ключ для ScrapingBee (опционально)
- `DISABLE_VIDEO_TRANSCRIPTION` - отключить транскрибацию видео (true/false)
- `AI_MODEL` - модель AI (по умолчанию gemini-2.5-flash)

## Шаги деплоя

1. **Подключите репозиторий к Railway**
   - Создайте новый проект в Railway
   - Подключите GitHub репозиторий
   - Выберите папку `ai-content-curator/server`

2. **Добавьте PostgreSQL базу данных**
   - В Railway Dashboard добавьте PostgreSQL сервис
   - Railway автоматически создаст переменную `DATABASE_URL`

3. **Установите переменные окружения**
   - Перейдите в Settings → Variables
   - Добавьте все необходимые переменные из списка выше

4. **Настройте деплой**
   - Railway автоматически обнаружит `railway.json` и `Dockerfile`
   - При деплое будет запущен и сервер, и бот вместе

5. **Проверьте работу**
   - После деплоя проверьте логи в Railway Dashboard
   - Должны быть сообщения о запуске сервера и бота
   - Проверьте работу бота, отправив ему сообщение в Telegram

## Важные замечания

- **Порт**: Railway автоматически устанавливает переменную `PORT`. Сервер будет слушать на этом порту.
- **Бот и сервер**: Оба запускаются в одном процессе через `start:all` скрипт
- **База данных**: Убедитесь, что PostgreSQL сервис запущен и `DATABASE_URL` правильно настроен
- **CORS**: Если фронтенд на другом домене, добавьте его в `CORS_ORIGIN`

## Проверка работоспособности

После деплоя проверьте:
1. API доступен по URL Railway (должен вернуть "API is running...")
2. Бот отвечает на команду `/start` в Telegram
3. База данных подключена (проверьте логи на наличие ошибок подключения)

## Решение проблем

### Бот не отвечает
- Проверьте `TELEGRAM_BOT_TOKEN` в переменных окружения
- Проверьте логи на наличие ошибок запуска бота

### Ошибки подключения к БД
- Убедитесь, что PostgreSQL сервис запущен
- Проверьте `DATABASE_URL` в переменных окружения
- Проверьте логи на детали ошибки подключения

### CORS ошибки
- Добавьте домен фронтенда в `CORS_ORIGIN`
- Убедитесь, что переменная установлена правильно (через запятую для нескольких доменов)

